{% extends 'base.html' %}
{% load static %}
{% load dispatch_custom_tags %}

{% block head %}
<meta http-equiv="Cache-Control" content="private, no-cache, no-store, max-age=0, must-revalidate">
<link rel="stylesheet" href="{% static 'css/dispatch/dispatchBase.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'css/dispatch/regularly.css' %}" type="text/css" />
{% endblock %}

{% block content-header %}
<div class="HeaderTitle">
  출/퇴근 배차
</div>
{% endblock %}


{% block content %}

<div class="regularly_layout">



  <!-- 스케줄 -->
  <div class="schedule">

    <!-- 스케줄-헤더 -->
    <div class="scheduleHeaderArea">
      <div class="scheduleHeader"></div>
    </div>

    <!-- 스케줄-바디 -->
    <div class="scheduleBodyArea">
      <div class="hourMarker">
        <div>0</div>
        <div>4</div>
        <div>8</div>
        <div>12</div>
        <div>16</div>
        <div>20</div>
        <div>24</div>
      </div>
      <div class="scheduleTableScroll">
        <div class="scheduleTable">
          {% for v in vehicles %}
          <div class="scheduleTableTr">
            <div class="hourTd"></div>
            <div class="hourTd"></div>
            <div class="hourTd"></div>
            <div class="hourTd"></div>
            <div class="hourTd"></div>
            <div class="hourTd"></div>
            <div class="hourTd"></div>
            <div class="driverTd {{v.id}} d{{v.driver.id}}">{{v.vehicle_num}}({{v.driver_name}})</div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

  </div>





  <div class="main_Layout">



    <!-- 검색창 -->
    <div class="search">

      <div class="searchTitle">그룹검색</div>

      <form action="" class="searchForm">

        <!-- 변경영역 -->
        <div class="search_inputArea">
          <label for="">그룹</label>
          <select name="group" id="">
            <option></option>
            {% for group in groups %}
            <option {% if selected_group == group.id %} selected {% endif %} value="{{group.id}}">{{group.name}}</option>
            {% endfor %}
          </select>
          <label for="">날짜</label>
          <input name="date" type="date" class="searchDate">
          <div class="dateControllBtnBox">
            <div class="dateControllBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="8.6" height="13" viewBox="0 0 8.6 13">
                <path id="Icon_ionic-ios-arrow-back" data-name="Icon ionic-ios-arrow-back"
                  d="M13.843,12.692l5.692-4.915a.839.839,0,0,0,0-1.312,1.2,1.2,0,0,0-1.523,0l-6.449,5.569a.839.839,0,0,0-.031,1.281l6.475,5.608a1.205,1.205,0,0,0,1.523,0,.839.839,0,0,0,0-1.312Z"
                  transform="translate(-11.25 -6.194)" fill="#fff" />
              </svg>
            </div>
            <div class="dateControllBtn">
              <svg xmlns="http://www.w3.org/2000/svg" width="8.6" height="13" viewBox="0 0 8.6 13">
                <path id="Icon_ionic-ios-arrow-back" data-name="Icon ionic-ios-arrow-back"
                  d="M17.258,12.692,11.566,7.777a.839.839,0,0,1,0-1.312,1.2,1.2,0,0,1,1.523,0l6.448,5.569a.839.839,0,0,1,.031,1.281l-6.475,5.608a1.205,1.205,0,0,1-1.523,0,.839.839,0,0,1,0-1.312Z"
                  transform="translate(-11.25 -6.194)" fill="#fff" />
              </svg>
            </div>
          </div>
        </div>

        <input type="submit" class="btnModules searchBtn" value="검색">

      </form>

    </div>



    <!-- 입력창 -->
    <form class="input">
      <input type="submit" value="저장" class="btnModules inputSave">
      <table>
        <tr>
          <td class="InputHeader InputHeaderBordeTopLeft">그룹</td>
          <td class="InputTd">
            <select name="" id="selectGroup" class="inputSelect">
              <option></option>
              {% for group in groups %}
              <option {% if detail.group.id == group.id %} selected {% endif %} value="{{group.id}}">{{group.name}}</option>
              {% endfor %}
            </select>
          </td>
          <td class="InputHeader">노선이름</td>
          <td class="InputTd">
            <input type="text" class="inputText" value="{{detail.route}}">
          </td>
          <td class="InputHeader">출/퇴근</td>
          <td class="InputTd">
            <div class="workTypeBox">
              <input type="radio" id="regularlyWorkStart" {% if detail.work_type == '출근' %} checked {% endif %}>
              <label for="regularlyWorkStart">출근</label>
              <input type="radio" id="regularlyWorkEnd" {% if detail.work_type == '퇴근' %} checked {% endif %}>
              <label for="regularlyWorkEnd">퇴근</label>
            </div>
          </td>
          <td class="InputHeader">주차</td>
          <td class="InputTd">
            <input type="text" class="inputText" value="{{detail.parking}}">
          </td>
        </tr>
        <tr>
          <td class="InputHeader">출발지</td>
          <td colspan="3">
            <input type="text" class="inputText" value="{{detail.departure}}">
          </td>
          <td class="InputHeader">운행요일</td>
          <td colspan="3">
            <div class="driveDateBox">
              <input type="checkbox" id="regularlyCheckAll">
              <label for="regularlyCheckAll">전체</label>
              <input type="checkbox" id="regularlyCheckWeek6" {% if detail and detail.week|in_check:'일' %} checked {% endif %}>
              <label for="regularlyCheckWeek6">일</label>
              <input type="checkbox" id="regularlyCheckWeek0" {% if detail and detail.week|in_check:'월' %} checked {% endif %}>
              <label for="regularlyCheckWeek0">월</label>
              <input type="checkbox" id="regularlyCheckWeek1" {% if detail and detail.week|in_check:'화' %} checked {% endif %}>
              <label for="regularlyCheckWeek1">화</label>
              <input type="checkbox" id="regularlyCheckWeek2" {% if detail and detail.week|in_check:'수' %} checked {% endif %}>
              <label for="regularlyCheckWeek2">수</label>
              <input type="checkbox" id="regularlyCheckWeek3" {% if detail and detail.week|in_check:'목' %} checked {% endif %}>
              <label for="regularlyCheckWeek3">목</label>
              <input type="checkbox" id="regularlyCheckWeek4" {% if detail and detail.week|in_check:'금' %} checked {% endif %}>
              <label for="regularlyCheckWeek4">금</label>
              <input type="checkbox" id="regularlyCheckWeek5" {% if detail and detail.week|in_check:'토' %} checked {% endif %}>
              <label for="regularlyCheckWeek5">토</label>
            </div>
          </td>
        </tr>
        <tr>
          <td class="InputHeader">도착지</td>
          <td colspan="3">
            <input type="text" class="inputText" value="{{detail.arrival}}">
          </td>
          <td class="InputHeader">금액</td>
          <td class="InputTd"><input type="text" class="inputText inputTextUnit" value="{{detail.price}}">원</td>
          <td class="InputHeader">기사수당</td>
          <td class="InputTd"><input type="text" class="inputText inputTextUnit" value="{{detail.driver_allowance}}">원</td>
        </tr>
        <tr>
          <td class="InputHeader InputHeaderBordeBottomLeft">순번</td>
          <td class="InputTd">
            <div class="twiceBox">
              <input value="{{detail.number1}}" type="number" class="inputTextTwice">-<input value="{{detail.number2}}" type="number" class="inputTextTwice">
            </div>
          </td>
          <td class="InputHeader">운행시간</td>
          <td class="InputTd">
            <div class="twiceBox">
              <div class="quarterBox">
                <input type="text" class="inputTextTwice" value="{{detail.departure_time|slice:':2'}}">
                :
                <input type="text" class="inputTextTwice" value="{{detail.departure_time|slice:'3:'}}">
              </div>
              ~
              <div class="quarterBox">
                <input type="text" class="inputTextTwice" value="{{detail.arrival_time|slice:':2'}}">
                :
                <input type="text" class="inputTextTwice" value="{{detail.arrival_time|slice:'3:'}}">
              </div>
            </div>
          </td>
          <td class="InputHeader">참조사항</td>
          <td colspan="3"><input type="text" class="inputText" value="{{detail.references}}"></td>
        </tr>
      </table>
    </form>



    <!-- 노선목록 -->
    <form class="list">
      <div class="listHeader">
        <span>그룹이름</span>
        <input type="submit" value="엑셀로 내려받기" class="btnModules listExcel">
      </div>
      <table class="listTable">
        <thead>
          <tr>
            <td>순번</td>
            <td>주차</td>
            <td>차량</td>
            <td>운전원</td>
            <td>용역</td>
            <td>운행시간</td>
            <td>노선이름</td>
            <td>출발지</td>
            <td>참조사항</td>
          </tr>
        </thead>
      </table>
      <div class="listTableScroll">
        <table class="listTable">
          <tbody>
            {% for order in order_list %}
            <tr onclick="location.href='{% url 'dispatch:regularly' %}?id={{order.id}}&group={{selected_group}}&date={{date}}'" class="{{order.id}}">
              <td>{{order.number1}}{% if order.number2 %}- {{order.number2}} {% endif %}</td>
              <td>{{order.parking}}</td>
              <td></td>
              <td>
                <select name="" id="selectDriver{{order.id}}" class="orderDriver">
                  <option value=""></option>
                </select>
              </td>
              <td>
                <input type="text" class="orderSpareDriver">
              </td>
              <td>{{order.departure_time}} ~ {{order.arrival_time}}</td>
              <td>{{order.route}}</td>
              <td>{{order.departure}}</td>
              <td>{{order.references}}</td>
                <input type="hidden">
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
  </div>

  </form>




</div>
{% endblock %}



{% block script %}
<script>
  {% autoescape off %}
  const data = {{ dispatch_list }}
  const driverObj = {{ driver_dict }}
  console.log("DATA", data)
  console.log("driverObj", driverObj)
  {% endautoescape %}
</script>
<script src="{% static 'js/dispatch/oneStepDate.js' %}"></script>
<script src="{% static 'js/dispatch/checker.js' %}"></script>
<script src="{% static 'js/dispatch/FullSchedule.js' %}"></script>
<script src="{% static 'js/dispatch/regularlyDispatch.js' %}"></script>
{% endblock %}