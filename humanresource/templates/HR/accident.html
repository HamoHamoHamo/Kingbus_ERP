{% extends 'base.html' %}
{% load static %}
{% load custom_tags %}
{% block head %}
<meta http-equiv="Cache-Control" content="private, no-cache, no-store, max-age=0, must-revalidate">

<link rel="stylesheet" href="{% static 'css/humanresource/popup.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'css/humanresource/accident.css' %}" type="text/css" />
{% endblock %}

{% block content-header %}
<div class="HeaderTitle">
    사고관리
</div>
{% endblock %}

<!-- Content Block -->
{% block content %}
<div class="all-container efficiency-div">
    <div class="search-container efficiency-div"> <!-- 검색 box-->
        <form action="" class="search-form efficiency-div">
            <div class="search-dispatch-path-box efficiency-div">
                <input type="text" name="name" placeholder="노선명 및 이름을 입력하세요." class="search-dispatch-path">
                <input type="date" name="date" class="search-dispatch-path-date">
                <input type="submit" value="오늘" class="dispatch-path-today-button">
                <input type="submit" value="" class="day-before-button">
                <input type="submit" value="" class="day-after-button">
                <input type="submit" value="검색" class="dispatch-path-search-button">
            </div>
        </form>

        <div class="search-filter-box efficiency-div">
            <div class="search-filter-button-box">
                <input type="button" value="삭제" class="search-filter-button" id="delete-button">
                <input type="button" value="등록" class="search-filter-button" id="register-button">
            </div>
        </div>

        <div class="search-table-box efficiency-div">
            <table class="table-list">
                <thead class="scrolling_table-list_header">
                    <tr class="table-list_head-tr">
                        <td class="table-list_head-tr_td">
                            <input type="checkbox" class="amountCheckAll">
                        </td>
                        <td class="table-list_head-tr_td">번호</td>
                        <td class="table-list_head-tr_td">이름</td>
                        <td class="table-list_head-tr_td">결재</td>
                        <td class="table-list_head-tr_td">사고서류</td>
                        <td class="table-list_head-tr_td">과실유무</td>
                        <td class="table-list_head-tr_td">노선명</td>
                        <td class="table-list_head-tr_td">차량번호</td>
                        <td class="table-list_head-tr_td">탑승인원</td>
                        <td class="table-list_head-tr_td">부상자</td>
                        <td class="table-list_head-tr_td">발생지점</td>
                        <td class="table-list_head-tr_td">사고날짜</td>
                        <td class="table-list_head-tr_td">업체명</td>
                        <td class="table-list_head-tr_td">담당업무</td>
                        <td class="table-list_head-tr_td">나이</td>
                    </tr>
                </thead>
                {% for accident in accident_list %}
                    <tbody class="scrolling_table-list_body">
                        <tr class="table-list_body-tr salaryList cursor">
                            <td class="table-list_body-tr_td">
                                <input tabindex="100" type="checkbox" class="amountCheck" name="member_id"
                                    value="{{ accident.member.id }}">
                            </td>
                            <td class="table-list_body-tr_td">{{ objects_cnt|add:forloop.counter }}</td> <!-- 번호 -->
                            <td class="table-list_body-tr_td">
                                <button class="accident-detail-button" type="button">
                                    {{ accident.driver_name }}
                                </button>
                            </td> <!-- 이름 -->
                            <td class="table-list_body-tr_td">0/4</td> <!-- 결재 -->
                            <td class="table-list_body-tr_td">0/15</td> <!-- 사고서류 -->
                            <td class="table-list_body-tr_td">유/60%</td> <!-- 과실유무 -->
                            <td class="table-list_body-tr_td">
                                남양출근 <!-- 노선명 -->
                            </td>
                            <td class="table-list_body-tr_td">
                               {{ accident.vehicle_num0 }} {{ accident.vehicle_num }} <!-- 차량번호 -->
                            </td>
                            <td class="table-list_body-tr_td">
                                {{ accident.passenger_num }}명 <!-- 탑승인원 -->
                            </td>
                            <td class="table-list_body-tr_td">
                                1명 <!-- 부상자 -->
                            </td>
                            <td class="table-list_body-tr_td">
                                용인서울고속도로 <!-- 발생지점 -->
                            </td>
                            <td class="table-list_body-tr_td">
                                24.02.12 <!-- 사고날짜 -->
                            </td>
                            <td class="table-list_body-tr_td">
                                {{ accident.company }} <!-- 업체명 -->
                            </td>
                            <td class="table-list_body-tr_td">
                                {{ accident.role }} <!-- 담당업무 -->
                            </td>
                            <td class="table-list_body-tr_td">
                                42 <!-- 나이 -->
                            </td>
                        </tr>
                    </tbody>
                {% endfor %}
            </table>
            
        </div>
        <div class="paging">
            {% if page_obj.has_previous %}
                <a href="?page=1" class="first">처음</a>
                <a href="?page={{ page_obj.previous_page_number }}" class="prev">이전</a>
            {% endif %}

            <span>
                <p>{{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</p>
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}" class="next">다음</a>
                <a href="?page={{ page_obj.paginator.num_pages }}" class="last">마지막</a>
            {% endif %}
        </div>
    </div>

</div>

{% endblock %}

<!-- Popup Block -->
{% block popup %}
    <div class="pop-up-bg-container" style="display: none">
      <div class="pop-up-container">
        <div class="title-container">
          <div class="title-div">
            <span id="title-first-child">상세</span>
            <span id="title-second-child">사고관리</span>
          </div>
          <div class="button-div">
            <input
              type="button"
              value="닫기"
              class="search-filter-button"
              id="close-popup-button"
            />
            <input
              type="button"
              value="완료"
              class="search-filter-button"
              id="complete-button"
            />
          </div>
        </div>

        <div class="content-container">
          <div class="content-first-container">
            <div class="accident-detail-info-div">
              <span class="title-span">상세 정보</span>
              <div class="accident-detail-info-content-div">
                <div class="accident-detail-header">
                  <div class="our-car-number">
                    <span>차량번호 : </span>
                    <span id="our-car-number-value">경기70바 7554</span>
                  </div>
                  <div class="other-car-number">
                    <span>피해차량 : </span>
                    <span>55구 1601</span>
                  </div>
                </div>
                <div class="accident-detail-body">
                  <div class="accident-detail-content first">
                    <div class="content-div">
                      <span>기사이름 : </span>
                      <span id="name-value">유성재</span>
                    </div>
                    <div class="content-div">
                      <div class="dropdown">
                        <span>업체명 : </span>
                        <div class="dropdown-content" id="dropdown-content">
                          <select name="select" class="searchType">
                            <option value="오랜친구같은 여행사 ">
                              오랜친구같은 여행사
                            </option>
                            <option value="성화투어">성화투어</option>
                            <option value="성화관광">성화관광</option>
                            <option value="영투어">영투어</option>
                            <option value="신성화투어">신성화투어</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="accident-detail-content second">
                    <span>노선명 : </span>
                    <span>남양출근</span>
                  </div>
                  <div class="accident-detail-content third">
                    <span>사고 발생 지점 : </span>
                    <input
                      type="text"
                      class="content-Text"
                      id="accident-location"
                      value="용인서울고속도로"
                    />
                  </div>
                  <div class="accident-detail-content fourth">
                    <div class="content-div">
                      <span>사고 발생 시간 : </span>
                      <input
                        type="text"
                        class="content-TimeText"
                        id="recovery-hour"
                        value="17"
                        size="2"
                        maxlength="2"
                      />
                      <span>시 </span>
                      <input
                        type="text"
                        class="content-TimeText"
                        id="recovery-minute"
                        value="59"
                        size="2"
                        maxlength="2"
                      />
                      <span>분</span>
                    </div>
                    <div class="content-div">
                      <span>운행 재개 시간 : </span>
                      <input
                        type="text"
                        class="content-TimeText"
                        id="recovery-hour"
                        value="17"
                        size="2"
                        maxlength="2"
                      />
                      <span>시 </span>
                      <input
                        type="text"
                        class="content-TimeText"
                        id="recovery-minute"
                        value="59"
                        size="2"
                        maxlength="2"
                      />
                      <span>분</span>
                    </div>
                  </div>
                  <div class="accident-detail-content fifth">
                    <div class="content-div">
                      <span>당시 차량 속도 : </span>
                      <input
                        type="text"
                        class="content-KmText"
                        id="car-speed"
                        value="70"
                      />
                      km
                    </div>
                    <div class="content-div">
                      <span>과실유무 : </span>
                      <input
                        type="radio"
                        class="fault-radio"
                        name="fault-status"
                        id="fault-status-yes"
                        value="유"
                      />
                      <label for="fault-status-yes">유</label>
                      <input
                        type="radio"
                        class="fault-radio"
                        name="fault-status"
                        id="fault-status-no"
                        value="무"
                      />
                      <label for="fault-status-no">무</label>
                    </div>
                  </div>
                  <div class="accident-detail-content sixth">
                    <span>부상자 : </span>
                    <input
                      type="text"
                      class="content-InjuredText"
                      id="injured"
                      value="1/41"
                    />
                    (명)
                  </div>
                </div>
              </div>
            </div>
            <div class="accident-photo-div">
              <span class="title-span">사고 사진</span>
              <div class="accident-photo-content-div">
                <div class="accident-photo-content-header">
                  <div class="coverage-div">
                    <!-- 자차 -->
                    <input
                      type="radio"
                      name="insurance"
                      id="coverage"
                      checked
                    />
                    <label for="coverage">자차</label>
                  </div>
                  <div class="liability-div">
                    <!-- 대인/대물 -->
                    <input type="radio" name="insurance" id="liability" />
                    <label for="liability">대인/대물</label>
                  </div>
                </div>

                <form
                  class="accident-photo-form"
                  method="post"
                  enctype="multipart/form-data"
                >
                  <div class="accident-photo-content-body">
                    <div class="accident-photo-content">
                      <div class="accident-photo-title-div">
                        <span>내 차량</span>
                      </div>
                      <button
                        class="prev-button"
                        type="button"
                        onclick="slide('my-car-photos', -1)"
                      >
                        &#10094;
                      </button>
                      <div class="accident-photo-slider">
                        <div class="accident-photo-file-div" id="my-car-photos">
                          <div class="photo-preview-div">
                            <input
                              type="file"
                              class="upload-image"
                              accept="image/*"
                              onchange="previewImage(this, 'my-car-photos')"
                            />
                          </div>
                          <div class="photo-preview-div">
                            <input
                              type="file"
                              class="upload-image"
                              accept="image/*"
                              onchange="previewImage(this, 'my-car-photos')"
                            />
                          </div>
                          <div class="photo-preview-div">
                            <input
                              type="file"
                              class="upload-image"
                              accept="image/*"
                              onchange="previewImage(this, 'my-car-photos')"
                            />
                          </div>
                        </div>
                      </div>
                      <button
                        class="next-button"
                        type="button"
                        onclick="slide('my-car-photos', 1)"
                      >
                        &#10095;
                      </button>
                    </div>

                    <div class="accident-photo-content">
                      <div class="accident-photo-title-div">
                        <span>상대 차량</span>
                      </div>
                      <button
                        class="prev-button"
                        type="button"
                        onclick="slide('other-car-photos', -1)"
                      >
                        &#10094;
                      </button>
                      <div class="accident-photo-slider">
                        <div
                          class="accident-photo-file-div"
                          id="other-car-photos"
                        >
                          <div class="photo-preview-div">
                            <input
                              type="file"
                              class="upload-image"
                              accept="image/*"
                              onchange="previewImage(this, 'other-car-photos')"
                            />
                          </div>
                          <div class="photo-preview-div">
                            <input
                              type="file"
                              class="upload-image"
                              accept="image/*"
                              onchange="previewImage(this, 'other-car-photos')"
                            />
                          </div>
                          <div class="photo-preview-div">
                            <input
                              type="file"
                              class="upload-image"
                              accept="image/*"
                              onchange="previewImage(this, 'other-car-photos')"
                            />
                          </div>
                        </div>
                      </div>
                      <button
                        class="next-button"
                        type="button"
                        onclick="slide('other-car-photos', 1)"
                      >
                        &#10095;
                      </button>
                    </div>

                    <div class="accident-photo-content">
                      <div class="accident-photo-title-div">
                        <span>접촉 부위</span>
                      </div>
                      <button
                        class="prev-button"
                        type="button"
                        onclick="slide('impact-photos', -1)"
                      >
                        &#10094;
                      </button>
                      <div class="accident-photo-slider">
                        <div class="accident-photo-file-div" id="impact-photos">
                          <div class="photo-preview-div">
                            <input
                              type="file"
                              class="upload-image"
                              accept="image/*"
                              onchange="previewImage(this, 'impact-photos')"
                            />
                          </div>
                          <div class="photo-preview-div">
                            <input
                              type="file"
                              class="upload-image"
                              accept="image/*"
                              onchange="previewImage(this, 'impact-photos')"
                            />
                          </div>
                          <div class="photo-preview-div">
                            <input
                              type="file"
                              class="upload-image"
                              accept="image/*"
                              onchange="previewImage(this, 'impact-photos')"
                            />
                          </div>
                        </div>
                      </div>
                      <button
                        class="next-button"
                        type="button"
                        onclick="slide('impact-photos', 1)"
                      >
                        &#10095;
                      </button>
                    </div>

                    <div class="accident-photo-content">
                      <div class="accident-photo-title-div">
                        <span>승객 명단</span>
                      </div>
                      <button
                        class="prev-button"
                        type="button"
                        onclick="slide('passenger-list-photos', -1)"
                      >
                        &#10094;
                      </button>
                      <div class="accident-photo-slider">
                        <div
                          class="accident-photo-file-div"
                          id="passenger-list-photos"
                        >
                          <div class="photo-preview-div">
                            <input
                              type="file"
                              class="upload-image"
                              accept="image/*"
                              onchange="previewImage(this, 'passenger-list-photos')"
                            />
                          </div>
                          <div class="photo-preview-div">
                            <input
                              type="file"
                              class="upload-image"
                              accept="image/*"
                              onchange="previewImage(this, 'passenger-list-photos')"
                            />
                          </div>
                          <div class="photo-preview-div">
                            <input
                              type="file"
                              class="upload-image"
                              accept="image/*"
                              onchange="previewImage(this, 'passenger-list-photos')"
                            />
                          </div>
                        </div>
                      </div>
                      <button
                        class="next-button"
                        type="button"
                        onclick="slide('passenger-list-photos', 1)"
                      >
                        &#10095;
                      </button>
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <div class="accident-file-div">
              <span class="title-span">사고 파일</span>
              <div class="accident-file-content-div">
                <div class="accident-file-body">
                  <div class="accident-file-content">
                    <span>사고보고서</span>
                    <div class="file-div">
                      <input
                        class="upload-name"
                        value="첨부파일"
                        placeholder="첨부파일"
                      />
                      <div class="file-box">
                        <label for="accident-report-file">파일찾기</label>
                        <input
                          type="file"
                          name="accident-report-file"
                          id="accident-report-file"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="accident-file-content">
                    <span>사고사진</span>
                    <div class="file-div">
                      <input
                        class="upload-name"
                        value="첨부파일"
                        placeholder="첨부파일"
                      />
                      <div class="file-box">
                        <label for="accident-photo-file">파일찾기</label>
                        <input
                          type="file"
                          name="accident-photo-file"
                          id="accident-photo-file"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="accident-file-content">
                    <span>자동차 점검 정비 명세서</span>
                    <div class="file-div">
                      <input
                        class="upload-name"
                        value="첨부파일"
                        placeholder="첨부파일"
                      />
                      <div class="file-box">
                        <label for="accident-car-maintenance-file"
                          >파일찾기</label
                        >
                        <input
                          type="file"
                          name="accident-car-maintenance-file"
                          id="accident-car-maintenance-file"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="accident-file-content">
                    <span>운전면허증</span>
                    <div class="file-div">
                      <input
                        class="upload-name"
                        value="첨부파일"
                        placeholder="첨부파일"
                      />
                      <div class="file-box">
                        <label for="accident-driver-id-file">파일찾기</label>
                        <input
                          type="file"
                          name="accident-driver-id-file"
                          id="accident-driver-id-file"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="accident-file-content">
                    <span>자동차 공제 사고 접수서</span>
                    <div class="file-div">
                      <input
                        class="upload-name"
                        value="첨부파일"
                        placeholder="첨부파일"
                      />
                      <div class="file-box">
                        <label for="accident-car-deduction-file"
                          >파일찾기</label
                        >
                        <input
                          type="file"
                          name="accident-car-deduction-file"
                          id="accident-car-deduction-file"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="accident-file-content">
                    <span>공제금 지급청구소</span>
                    <div class="file-div">
                      <input
                        class="upload-name"
                        value="첨부파일"
                        placeholder="첨부파일"
                      />
                      <div class="file-box">
                        <label for="accident-deduction-request-file"
                          >파일찾기</label
                        >
                        <input
                          type="file"
                          name="accident-deduction-request-file"
                          id="accident-deduction-request-file"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="accident-file-content">
                    <span>이행확약서</span>
                    <div class="file-div">
                      <input
                        class="upload-name"
                        value="첨부파일"
                        placeholder="첨부파일"
                      />
                      <div class="file-box">
                        <label for="accident-commitment-file">파일찾기</label>
                        <input
                          type="file"
                          name="accident-commitment-file"
                          id="accident-commitment-file"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="accident-file-content no-border">
                    <span>합의서</span>
                    <div class="file-div">
                      <input
                        class="upload-name"
                        value="첨부파일"
                        placeholder="첨부파일"
                      />
                      <div class="file-box">
                        <label for="accident-agreement-file">파일찾기</label>
                        <input
                          type="file"
                          name="accident-agreement-file"
                          id="accident-agreement-file"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="content-second-container">
            <div>
              <span class="title-span">과실 - 상세</span>
            </div>
            <div class="report-div">
              <div class="accident-report-div">
                <table class="negligence-percentage-table">
                  <tr>
                    <th>성화투어</th>
                    <th>상대차량</th>
                  </tr>
                  <tr>
                    <td>
                      <input
                        type="text"
                        class="content-FruitText"
                        id="negligence-tour"
                        value="20"
                        %
                      />
                      %
                    </td>
                    <td>
                      <input
                        type="text"
                        class="content-FruitText"
                        id="negligence-other"
                        value="80"
                      />
                      %
                    </td>
                  </tr>
                </table>
                <div class="accident-details-div">
                  <div class="accident-details-title-div">
                    <span>사고상황</span>
                  </div>
                  <div class="accident-details-text-div">
                    <textarea
                      class="content-OverviewText"
                      id="driver-report"
                      maxlength="77"
                      rows="3"
                    ></textarea>
                  </div>
                </div>
              </div>
              <div class="driver-report-div">
                <div class="driver-report-title-div">
                  <span class="driver-report-title">사고 개요</span>
                  <br />
                  <span class="driver-report-subtitle">(운전자 경위서)</span>
                </div>
                <div class="driver-report-text-div">
                  <textarea
                    class="content-OverviewText"
                    id="driver-report"
                    maxlength="77"
                    rows="3"
                  ></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

{% endblock %}

<!-- Script Block -->
{% block script %}
<script src="{% static 'js/hr/accident.js' %}"></script>
<script type="text/javascript">
    const detailButtons = document.getElementsByClassName("accident-detail-button");
    const ourCarNumberValue = document.getElementById("our-car-number-value");
    const nameValue = document.getElementById("name-value");

    {% for accident in accident_list %}
    for (let detailButton of detailButtons) {
        detailButton.addEventListener("click", () => {
            if (detailButton.innerText === "{{ accident.driver_name }}") {
                document.querySelector(".pop-up-bg-container").style.display = "flex";
                ourCarNumberValue.textContent = "{{ accident.vehicle_num0 }} {{ accident.vehicle_num }}"
                nameValue.textContent = "{{ accident.driver_name }}"
            }
        });
    }
    {% endfor %}

    // 추가된 코드: 등록 버튼 클릭 시 팝업 열기
    document.getElementById("register-button").addEventListener("click", () => {
        document.querySelector(".pop-up-bg-container").style.display = "flex";
    });

    document.getElementById("close-popup-button").addEventListener("click", () => {
        document.querySelector(".pop-up-bg-container").style.display = "none";
    });

    function closeEstimatePopup() {
        document.querySelector(".estimate-pop-up-bg-container").style.display = "none";
    }

    function toggleDropdown() {
        document.getElementById("dropdown-content").classList.toggle("show");
    }

    // 드롭다운 외부를 클릭하면 드롭다운을 닫는 기능 추가
    window.onclick = function(event) {
        if (!event.target.matches('.dropdown-button')) {
            var dropdowns = document.getElementsByClassName("dropdown-content");
            for (var i = 0; i < dropdowns.length; i++) {
                var openDropdown = dropdowns[i];
                if (openDropdown.classList.contains('show')) {
                    openDropdown.classList.remove('show');
                }
            }
        }
    }

    function toggleDropdown() {
        document.getElementById("dropdown-content").classList.toggle("show");
    }

    function selectDropdownItem(event, value) {
        event.preventDefault(); // 기본 링크 동작을 방지
        document.getElementById("dropdown-button").value = value;
        document.getElementById("dropdown-content").classList.remove("show");
    }

        function slide(containerId, direction) {
      const container = document.getElementById(containerId);
      const photos = container.querySelectorAll(".photo-preview-div");
      const containerWidth = container.offsetWidth;
      const photoWidth = photos[0].offsetWidth + 5; // 사진 한 개의 너비 + 간격
      const totalPhotos = photos.length;

      let maxIndex = totalPhotos - Math.floor(containerWidth / photoWidth);

      if (!container.dataset.index) {
        container.dataset.index = 0;
      }

      let currentIndex = parseInt(container.dataset.index);

      currentIndex += direction;
      if (currentIndex < 0) {
        currentIndex = 0;
      } else if (currentIndex > maxIndex) {
        currentIndex = maxIndex;
      }

      container.dataset.index = currentIndex;

      container.style.transform = `translateX(-${currentIndex * photoWidth}px)`;
    }

    function previewImage(input, containerId) {
      const file = input.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const img = document.createElement("img");
          img.src = e.target.result;

          const previewDiv = input.parentElement;
          previewDiv.innerHTML = ""; // Clear the div
          previewDiv.appendChild(img);

          const deleteButton = document.createElement("button");
          deleteButton.innerHTML = "&#10005;";
          deleteButton.className = "delete-button";
          deleteButton.onclick = function () {
            removeImage(previewDiv, containerId);
          };
          previewDiv.appendChild(deleteButton);

          updateAddButton(containerId);
        };
        reader.readAsDataURL(file);
      }
    }

    function removeImage(previewDiv, containerId) {
      previewDiv.remove();
      updateAddButton(containerId);
    }

    function updateAddButton(containerId) {
      const container = document.getElementById(containerId);
      const images = container.querySelectorAll("img");
      let previewDivs = container.querySelectorAll(".photo-preview-div");

      // 5개 이상 추가 못하게 처리
      if (images.length >= 5) {
        const uploadInputs = container.querySelectorAll(".upload-image");
        uploadInputs.forEach((input) => {
          input.parentElement.style.display = "none";
        });
      } else {
        const uploadInputs = container.querySelectorAll(".upload-image");
        uploadInputs.forEach((input) => {
          input.parentElement.style.display = "flex";
        });

        // 추가된 이미지 수가 previewDivs와 같을 때만 새로운 div 추가
        if (images.length === previewDivs.length) {
          const newPreviewDiv = document.createElement("div");
          newPreviewDiv.className = "photo-preview-div";
          newPreviewDiv.innerHTML = `<input type="file" class="upload-image" accept="image/*" onchange="previewImage(this, '${containerId}')"/>`;
          container.appendChild(newPreviewDiv);
        }
      }

      // 3개 이하로 줄어들면 3개까지 채우기
      while (previewDivs.length < 3) {
        const newPreviewDiv = document.createElement("div");
        newPreviewDiv.className = "photo-preview-div";
        newPreviewDiv.innerHTML = `<input type="file" class="upload-image" accept="image/*" onchange="previewImage(this, '${containerId}')"/>`;
        container.appendChild(newPreviewDiv);
        previewDivs = container.querySelectorAll(".photo-preview-div");
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      const photoContainers = document.querySelectorAll(
        ".accident-photo-file-div"
      );
      photoContainers.forEach((container) => {
        updateAddButton(container.id);
      });
    });
</script>
{% endblock %}